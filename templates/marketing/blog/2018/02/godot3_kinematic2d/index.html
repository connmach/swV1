	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.54.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Godot 3.0: Using KinematicBody2D &middot; KCC Blog </title>

  
  <link rel="stylesheet" href="/blog/css/poole.css">
  <link rel="stylesheet" href="/blog/css/syntax.css">
  <link rel="stylesheet" href="/blog/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  
  
  

  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link href="" rel="alternate" type="application/rss+xml" title="KCC Blog" />
</head>

	<body class="theme-base-0b">
		<div class="sidebar">
  <div class="container">
      <a href="/blog/">
      <img src="/blog//kcc-logo.png" width="150">
    <div class="sidebar-about">
          
      </a>
      <p class="lead">
       Lessons and info about teaching kids to code. 
      </p>
    </div>

    <ul class="sidebar-nav">
      
      
    </ul>

    
    <div class="sidebar-nav">
        Tags:
        <ul class="sidebar-nav">
                    
                    
                    <li><a href="/blog//tags/education" class="list-group-item">
                        <span class="badge">4</span>
                        education
                    </a></li>
                    
                    <li><a href="/blog//tags/gamedev" class="list-group-item">
                        <span class="badge">59</span>
                        gamedev
                    </a></li>
                    
                    <li><a href="/blog//tags/gamification" class="list-group-item">
                        <span class="badge">1</span>
                        gamification
                    </a></li>
                    
                    <li><a href="/blog//tags/godot" class="list-group-item">
                        <span class="badge">42</span>
                        godot
                    </a></li>
                    
                    <li><a href="/blog//tags/procgen" class="list-group-item">
                        <span class="badge">6</span>
                        procgen
                    </a></li>
                    
                    <li><a href="/blog//tags/pygame" class="list-group-item">
                        <span class="badge">18</span>
                        pygame
                    </a></li>
                    
                    <li><a href="/blog//tags/python" class="list-group-item">
                        <span class="badge">20</span>
                        python
                    </a></li>
                    
                    <li><a href="/blog//tags/shaders" class="list-group-item">
                        <span class="badge">1</span>
                        shaders
                    </a></li>
                    
                    <li><a href="/blog//tags/teaching" class="list-group-item">
                        <span class="badge">5</span>
                        teaching
                    </a></li>
                    
                    <li><a href="/blog//tags/tutorial" class="list-group-item">
                        <span class="badge">59</span>
                        tutorial
                    </a></li>
                    
        </ul>
    </div>
    
    <ul class="soc">
        <li><a class="soc-twitter" href="http://twitter.com/KidsCanCode"></a></li>
        <li><a class="soc-facebook" href="http://facebook.com/Kidscancode"></a></li>
        <li><a class="soc-github" href="https://github.com/kidscancode/"></a></li>
        <li><a class="soc-youtube" href="https://www.youtube.com/c/KidsCanCodeOrg"></a></li>
        <li><a class="soc-rss soc-icon-last" href="/blog/index.xml"></a></li>
    </ul>
    <p>&copy; 2019 KidsCanCode LLC.</p>
  </div>
</div>


		<div class="content container">
			<div class="post">
			 	<h1>Godot 3.0: Using KinematicBody2D</h1>
			  <span class="post-author">by Chris Bradfield</span>
			  <span class="post-date">Tue, Feb 13, 2018</span>
			  <span id="tags"> <h6>Tags:
			  
			    <a href="/blog/tags/godot">godot</a>
			  
			    <a href="/blog/tags/gamedev">gamedev</a>
			  
			    <a href="/blog/tags/tutorial">tutorial</a>
			  
			</h6></span>

			      <p><img src="/blog/img/godot_logo.png" width="450"></p>

<p>Godot offers a number of collision objects to provide both collision detection and response. Trying to decide which one to use for your project can be confusing. You can avoid problems and simplify development if you understand how each each works and what their pros and cons are. In this tutorial, we&rsquo;ll look at the <code>KinematicBody2D</code> node and show some examples of how it can be used.</p>

<!-- You can watch a video version of this lesson here:
<iframe width="560" height="315" src="https://www.youtube.com/embed/Z0w9Jviq57c" frameborder="0" allowfullscreen></iframe> -->

<h1 id="introduction-physics-bodies">Introduction: Physics bodies</h1>

<p>In game development you often need to know when two objects in the game space intersect or come into contact. This is known as <em>collision detection</em>. When a collision is detected, you typically want something to happen. This is known as <em>collision response</em>.</p>

<p>Godot offers three kinds of physics bodies, grouped under the <a href="http://docs.godotengine.org/en/latest/classes/class_physicsbody2d.html" target="_blank"><code>PhysicsBody2D</code></a> type:</p>

<ul>
<li><code>StaticBody2D</code></li>
</ul>

<p>A static body is one that is not moved by the physics engine. It participates in collision detection, but does not move in response to the collision. This type of body is most often used for objects that are part of the environment or that do not need to have any dynamic behavior.</p>

<ul>
<li><code>RigidBody2D</code></li>
</ul>

<p>This is the node that implements simulated 2D physics. You do not control a <code>RigidBody2D</code> directly, but instead you apply forces to it (gravity, impulses, etc.) and the physics engine calculates the resulting movement. See <a href="/blog/2017/12/godot3_kyn_rigidbody1/">Godot 3.0: Rigid Bodies</a> for more information.</p>

<ul>
<li><code>KinematicBody2D</code></li>
</ul>

<p>A body that provides collision detection, but no physics. All movement must be implemented in code.</p>

<h2 id="collision-shapes">Collision shapes</h2>

<p>A physics body can hold any number of <code>Shape2D</code> objects as children. These shapes are used to define the object&rsquo;s collision bounds and to detect contact with other objects.</p>

<blockquote>
<p><strong>Note:</strong> In order to detect collisions, at least one <code>Shape2D</code> must be assigned to the object.</p>
</blockquote>

<p>The most common way to assign a shape is by adding a <code>CollisionShape2D</code> or <code>CollisionPolygon2D</code> as a child of the object. These nodes allow you to draw the shape directly in the editor workspace.</p>

<blockquote>
<p><strong>Note:</strong> Be careful to never scale your collision shapes in the editor. The <code>Scale</code> property in the Inspector should remain at <code>(1, 1)</code>. When changing the size of the collision shape, you should always use the shape&rsquo;s handles, <em>not</em> the <code>Node2D</code> scale handles. Changing the scale can result in unexpected collision behavior.</p>
</blockquote>

<p>!player_coll_shape.png</p>

<h2 id="collision-layers-and-masks">Collision Layers and Masks</h2>

<p>One of the most powerful but frequently misunderstood collision features in Godot is the collision layer system. This system allows you to build up very complex interactions between a variety of objects. The key concepts are <em>layers</em> and <em>masks</em>. Each CollisionObject2D has 32 different physics layers it can interact with.</p>

<p>Let&rsquo;s look at each of the properties in turn:</p>

<ul>
<li><p><strong><code>collision_layer</code></strong>
describes the layers that the object appears <em>in</em>. By default, all bodies are on layer <code>1</code>.</p></li>

<li><p><strong><code>collision_mask</code></strong>
describes what layers the body will <em>scan</em> for collisions. If an object isn&rsquo;t in one of the mask layers, the body will ignore it. By default, all bodies scan layer <code>1</code>.</p></li>
</ul>

<p>You can also assign names to layers. In &ldquo;Project Settings&rdquo;, look for the &ldquo;Layer Names -&gt; 2D Physics&rdquo; section:</p>

<p><a href="/blog/img/k2d_layer_names.png"><img src="/blog/img/k2d_layer_names.png" width="300"></a></p>

<p>A body&rsquo;s layer properties can be configured via code, or directly in the Inspector:</p>

<p><a href="/blog/img/k2d_layer_example.png"><img src="/blog/img/k2d_layer_example.png" width="300"></a></p>

<p><strong>Example:</strong></p>

<p>You have three nodes with the following configuration:</p>

<table>
<thead>
<tr>
<th></th>
<th>Layers</th>
<th>Mask</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>Player</strong></td>
<td><code>1</code></td>
<td><code>2, 3</code></td>
</tr>

<tr>
<td><strong>Enemy</strong></td>
<td><code>2</code></td>
<td><code>1</code></td>
</tr>

<tr>
<td><strong>Coin</strong></td>
<td><code>3</code></td>
<td><code>1</code></td>
</tr>
</tbody>
</table>

<p>In this scenario, the <code>Player</code> node would detect collisions with both <code>Enemy</code> and <code>Coin</code> nodes (because they are in layers it scans). However, <code>Enemy</code> and <code>Coin</code> nodes would not detect each other, because they only scan layers they are <em>not</em> in.</p>

<h1 id="kinematic-bodies">Kinematic Bodies</h1>

<p><code>KinematicBody2D</code> is for implementing bodies that are to be controlled via code. They detect collisions with other bodies when moving, but are not affected by engine physics properties like gravity or friction. While this means that you have to write some code to create their behavior, it also means you have more precise control over how they move and react.</p>

<blockquote>
<p><strong>Note:</strong> A <code>KinematicBody2D</code> can be affected by gravity and other forces, but you must calculate the movement in code. The physics engine will not move a <code>KinematicBody2D</code>.</p>
</blockquote>

<h2 id="movement-and-collision">Movement and collision</h2>

<p>When moving a <code>KinematicBody2D</code>, you should not set its <code>position</code> directly. Instead, you use the <code>move_and_collide()</code> or <code>move_and_slide()</code> methods. These methods move the body along a given vector and will instantly stop if a collision is detected with another body. After a KinematicBody2D has collided, any <em>collision response</em> must be coded manually.</p>

<blockquote>
<p><strong>Note:</strong> Kinematic body movement should only be done in the <code>_physics_process()</code> callback.</p>
</blockquote>

<h3 id="move-and-collide">move_and_collide</h3>

<p>This method takes one parameter: a <code>Vector2</code> indicating the body&rsquo;s relative movement. Typically, this is your velocity vector multiplied by the frame timestep (<code>delta</code>). If the engine detects a collision anywhere along this vector, the body will immediately stop moving. If this happens, the method will return a <code>KinematicCollision2D</code> object.</p>

<h4 id="kinematiccollision2d">KinematicCollision2D</h4>

<p>When a KinematicBody2D detects a collision, Godot provides a <a href="http://docs.godotengine.org/en/latest/classes/class_kinematiccollision2d.html" target="_blank"><code>KinematicCollision2D</code></a> object. This object contains data about the collision and the colliding object. Using this data you can calculate your collision response.</p>

<h3 id="move-and-slide">move_and_slide</h3>

<p>The <code>move_and_slide()</code> method is intended to simplify the collision response in the common case where you want one body to slide along the other. This is especially useful in platformers or top-down games, for example.</p>

<blockquote>
<p><strong>NOTE:</strong> <code>move_and_slide()</code> automatically calculates frame-based movement using <code>delta</code>. Do <em>not</em> multiply your velocity vector by <code>delta</code> before passing it to <code>move_and_slide()</code>.</p>
</blockquote>

<p>In addition to the velocity vector, <code>move_and_slide</code> takes a number of other parameters allowing you to customize the slide behavior:</p>

<p><code>floor_normal</code> - default value: <code>Vector2( 0, 0 )</code></p>

<p>This parameter allows you to define what surfaces the engine should consider to be the floor. Setting this lets you use the <code>is_on_floor()</code>, <code>is_on_wall()</code>, and <code>is_on_ceiling()</code> methods to detect what type of surface the body is in contact with. The default value means that all surfaces are considered walls.</p>

<p><code>slope_stop_min_velocity</code> - default value: <code>5</code></p>

<p>This is the minimum velocity when standing on a slope. This prevents a body from sliding down a slope when standing still.</p>

<p><code>max_bounces</code> - default value: <code>4</code></p>

<p>This is the maximum number of collisions before the body stops moving. Setting this too low may prevent movement entirely.</p>

<p><code>floor_max_angle</code> - default value: <code>0.785398</code> (in radians, equivalent to 45 degrees)</p>

<p>This is the maximum angle before a surface is no longer considered a &ldquo;floor&rdquo;.</p>

<h2 id="which-to-use">Which to use?</h2>

<p>A common question from new Godot users is: &ldquo;How do you decide which movement function to use?&rdquo;
Often the response is to use <code>move_and_slide()</code> because it&rsquo;s &ldquo;simpler&rdquo;, but this is not
necessarily the case. One way to think of it is that <code>move_and_slide()</code> is a special case,
and <code>move_and_collide()</code> is more general. For example, the following two code snippets result in the same collision response:</p>

<p><a href="/blog/img/k2d_compare.gif"><img src="/blog/img/k2d_compare.gif" width="300"></a></p>

<p><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">var</span> <span class="n">collision</span> <span class="o">=</span> <span class="n">move_and_collide</span><span class="p">(</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
<span class="k">if</span> <span class="n">collision</span><span class="p">:</span>
	<span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">slide</span><span class="p">(</span><span class="n">collision</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span></code></pre></div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">velocity</span> <span class="o">=</span> <span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span></code></pre></div></p>

<p>Anything you do with <code>move_and_slide()</code> can also be done with <code>move_and_collide()</code>,
it just might take a little more code. However, as we&rsquo;ll see in the examples below,
there are cases where <code>move_and_slide()</code> isn&rsquo;t the response you want.</p>

<h1 id="examples">Examples</h1>

<p>Download the <a href="/blog/img/KYN3.0_KinematicBody2D.zip">Sample Project</a> for the examples
below.</p>

<h2 id="basic-movement">Basic movement</h2>

<p>If you&rsquo;ve downloaded the sample project, this example is in the &ldquo;BasicMovement.tscn&rdquo; scene.</p>

<p>For this example, Add a <code>KinematicBody2D</code> with two children: a <code>Sprite</code> and a <code>CollisionShape2D</code>. As with many demos, we&rsquo;ll use the Godot &ldquo;icon.png&rdquo; as the Sprite&rsquo;s texture (drag it from the Filesystem dock to the &ldquo;Texture&rdquo; property of the <code>Sprite</code>). In the <code>CollisionShape2D</code>&rsquo;s &ldquo;Shape&rdquo; property, select &ldquo;New RectangleShape2D&rdquo; and size the rectangle to fit over the sprite image.</p>

<p>Attach a script to the KinematicBody2D and add the following code:</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">extends</span> <span class="n">KinematicBody2D</span>

<span class="n">var</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">var</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">()</span>

<span class="n">func</span> <span class="n">get_input</span><span class="p">():</span>
	<span class="c1"># Detect up/down/left/right keystate and only move when pressed</span>
	<span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;ui_right&#39;</span><span class="p">):</span>
		<span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;ui_left&#39;</span><span class="p">):</span>
		<span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;ui_down&#39;</span><span class="p">):</span>
		<span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;ui_up&#39;</span><span class="p">):</span>
		<span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>
	<span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span> <span class="o">*</span> <span class="n">speed</span>

<span class="n">func</span> <span class="n">_physics_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
	<span class="n">get_input</span><span class="p">()</span>
	<span class="n">move_and_collide</span><span class="p">(</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span></code></pre></div>

<p>Run this scene and you&rsquo;ll see that <code>move_and_collide()</code> works as expected, moving
the body along the velocity vector. Now let&rsquo;s see what happens when you add
some obstacles. Add a StaticBody2D with a rectangular collision shape. For visibility,
you can use a sprite, a Polygon2D, or just turn on &ldquo;Visible Collision Shapes&rdquo; from
the &ldquo;Debug&rdquo; menu.</p>

<p>Run the scene again and try moving into the obstacle. You&rsquo;ll see that the <code>KinematicBody2D</code>
can&rsquo;t penetrate the obstacle. However, try moving into the obstacle at an angle and
you&rsquo;ll find that the obstacle acts like glue - it feels like the body gets stuck.</p>

<p>This happens because there is no <em>collision response</em>. <code>move_and_collide()</code> just stops
the body&rsquo;s movement when a collision occurs. We need to code whatever response we
want from the collision.</p>

<p>Try changing the function to <code>move_and_slide(velocity)</code> and running again. Note that we removed <code>delta</code> from the velocity calculation.</p>

<p><code>move_and_slide()</code> provides a default collision response of sliding the body along the
collision object. This is useful for a great many game types, and may be all you need
to get the behavior you want.</p>

<p>Next, we&rsquo;ll look at a few other examples.</p>

<h2 id="bouncing-reflecting-and-collision-detection">Bouncing/reflecting and collision detection</h2>

<p>What if you don&rsquo;t want a sliding collision response? For this example (&ldquo;BounceandCollide.tscn&rdquo;
in the sample project), we have a character shooting bullets and we want the bullets to
bounce off the walls.</p>

<p>For this example, we have three scenes: the main scene containing the Player, a Bullet,
and a Wall. The Bullet and Wall are separate scenes so that they can be instanced.</p>

<p>The Player is controlled by W/S for forward/back and aims using the mouse. Here is
the code for the Player, using <code>move_and_slide()</code>:</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">extends</span> <span class="n">KinematicBody2D</span>

<span class="n">export</span> <span class="p">(</span><span class="n">PackedScene</span><span class="p">)</span> <span class="n">var</span> <span class="n">Bullet</span>
<span class="n">export</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="n">var</span> <span class="n">speed</span>

<span class="n">var</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">()</span>

<span class="n">func</span> <span class="n">get_input</span><span class="p">():</span>
	<span class="c1"># add these actions in Project Settings -&gt; Input Map</span>
	<span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;backward&#39;</span><span class="p">):</span>
		<span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="o">-</span><span class="n">speed</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rotated</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;forward&#39;</span><span class="p">):</span>
		<span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rotated</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_just_pressed</span><span class="p">(</span><span class="s1">&#39;mouse_click&#39;</span><span class="p">):</span>
		<span class="n">shoot</span><span class="p">()</span>

<span class="n">func</span> <span class="n">shoot</span><span class="p">():</span>
	<span class="c1"># &#34;Muzzle&#34; is a Position2D placed at the barrel of the gun</span>
	<span class="n">var</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Bullet</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
	<span class="n">b</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="err">$</span><span class="n">Muzzle</span><span class="o">.</span><span class="n">global_position</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
	<span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">func</span> <span class="n">_physics_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
	<span class="n">get_input</span><span class="p">()</span>
	<span class="n">var</span> <span class="nb">dir</span> <span class="o">=</span> <span class="n">get_global_mouse_position</span><span class="p">()</span> <span class="o">-</span> <span class="n">global_position</span>
	<span class="c1"># Don&#39;t move if too close to the mouse pointer</span>
	<span class="k">if</span> <span class="nb">dir</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
		<span class="n">rotation</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">angle</span><span class="p">()</span>
		<span class="n">velocity</span> <span class="o">=</span> <span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span></code></pre></div>

<p>And the code for the Bullet:</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">extends</span> <span class="n">KinematicBody2D</span>

<span class="n">var</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">750</span>
<span class="n">var</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">()</span>

<span class="n">func</span> <span class="n">start</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
	<span class="n">rotation</span> <span class="o">=</span> <span class="nb">dir</span>
	<span class="n">position</span> <span class="o">=</span> <span class="n">pos</span>
	<span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rotated</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>

<span class="n">func</span> <span class="n">_physics_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
	<span class="n">var</span> <span class="n">collision</span> <span class="o">=</span> <span class="n">move_and_collide</span><span class="p">(</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">collision</span><span class="p">:</span>
		<span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">bounce</span><span class="p">(</span><span class="n">collision</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">collision</span><span class="o">.</span><span class="n">collider</span><span class="o">.</span><span class="n">has_method</span><span class="p">(</span><span class="s2">&#34;hit&#34;</span><span class="p">):</span>
			<span class="n">collision</span><span class="o">.</span><span class="n">collider</span><span class="o">.</span><span class="n">hit</span><span class="p">()</span>

<span class="n">func</span> <span class="n">_on_VisibilityNotifier2D_screen_exited</span><span class="p">():</span>
	<span class="n">queue_free</span><span class="p">()</span></code></pre></div>

<p>The action happens in <code>_physics_process()</code>. After using <code>move_and_collide()</code> if a
collision occurs, a <code>KinematicCollision2D</code> object is returned (otherwise, the return
is <code>Nil</code>).</p>

<p>If there is a returned collision, we use the <code>normal</code> of the collision to reflect
the bullet&rsquo;s <code>velocity</code>. <code>bounce()</code> is a <code>Vector2</code> method.</p>

<p>If the colliding object (<code>collider</code>) has a <code>hit</code> method,
we also call it. In the example project, we&rsquo;ve added a flashing color effect to
the Wall to demonstrate this.</p>

<p><a href="/blog/img/k2d_bullet_bounce.gif"><img src="/blog/img/k2d_bullet_bounce.gif" width="300"></a></p>

<h2 id="platforming-with-move-and-slide">Platforming with move_and_slide</h2>

<p>Let&rsquo;s try one more example - one that often gets asked about - the 2D platformer. <code>move_and_slide()</code> is ideal for quickly getting a functional character controller up and running. If you&rsquo;ve downloaded the sample project, you can find this in &ldquo;Platformer.tscn&rdquo;.</p>

<p>For this example, we&rsquo;ll assume you have a level made of StaticBody2D objects. They can be any shape and size. In the sample project, we&rsquo;re using a TileMap to lay out the level, but for the purposes of this demo, they could just as well be individual static bodies.</p>

<p>We&rsquo;re also using the adorable <a href="https://opengameart.org/content/sunny-land-2d-pixel-art-pack">&ldquo;Sunny Land&rdquo; art pack by Ansimuz</a> for the art and character animations.</p>

<p>Here&rsquo;s the code for the player body:</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">extends</span> <span class="n">KinematicBody2D</span>

<span class="n">export</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="n">var</span> <span class="n">run_speed</span>
<span class="n">export</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="n">var</span> <span class="n">jump_speed</span>
<span class="n">export</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="n">var</span> <span class="n">gravity</span>

<span class="n">enum</span> <span class="p">{</span><span class="n">IDLE</span><span class="p">,</span> <span class="n">RUN</span><span class="p">,</span> <span class="n">JUMP</span><span class="p">}</span>
<span class="n">var</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">()</span>
<span class="n">var</span> <span class="n">state</span>
<span class="n">var</span> <span class="n">anim</span>
<span class="n">var</span> <span class="n">new_anim</span>

<span class="n">func</span> <span class="n">_ready</span><span class="p">():</span>
    <span class="n">change_state</span><span class="p">(</span><span class="n">IDLE</span><span class="p">)</span>

<span class="n">func</span> <span class="n">change_state</span><span class="p">(</span><span class="n">new_state</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">new_state</span>
    <span class="n">match</span> <span class="n">state</span><span class="p">:</span>
        <span class="n">IDLE</span><span class="p">:</span>
            <span class="n">new_anim</span> <span class="o">=</span> <span class="s1">&#39;idle&#39;</span>
        <span class="n">RUN</span><span class="p">:</span>
            <span class="n">new_anim</span> <span class="o">=</span> <span class="s1">&#39;run&#39;</span>
        <span class="n">JUMP</span><span class="p">:</span>
            <span class="n">new_anim</span> <span class="o">=</span> <span class="s1">&#39;jump_up&#39;</span>

<span class="n">func</span> <span class="n">get_input</span><span class="p">():</span>
    <span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">var</span> <span class="n">right</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;ui_right&#39;</span><span class="p">)</span>
    <span class="n">var</span> <span class="n">left</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_pressed</span><span class="p">(</span><span class="s1">&#39;ui_left&#39;</span><span class="p">)</span>
    <span class="n">var</span> <span class="n">jump</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">is_action_just_pressed</span><span class="p">(</span><span class="s1">&#39;ui_select&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">jump</span> <span class="ow">and</span> <span class="n">is_on_floor</span><span class="p">():</span>
        <span class="n">change_state</span><span class="p">(</span><span class="n">JUMP</span><span class="p">)</span>
        <span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">jump_speed</span>
    <span class="k">if</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">change_state</span><span class="p">(</span><span class="n">RUN</span><span class="p">)</span>
        <span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">run_speed</span>
    <span class="k">if</span> <span class="n">left</span><span class="p">:</span>
        <span class="n">change_state</span><span class="p">(</span><span class="n">RUN</span><span class="p">)</span>
        <span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">run_speed</span>
    <span class="err">$</span><span class="n">Sprite</span><span class="o">.</span><span class="n">flip_h</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="err">!</span><span class="n">right</span> <span class="ow">and</span> <span class="err">!</span><span class="n">left</span> <span class="ow">and</span> <span class="n">state</span> <span class="o">==</span> <span class="n">RUN</span><span class="p">:</span>
        <span class="n">change_state</span><span class="p">(</span><span class="n">IDLE</span><span class="p">)</span>

<span class="n">func</span> <span class="n">_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
    <span class="n">get_input</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">new_anim</span> <span class="o">!=</span> <span class="n">anim</span><span class="p">:</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">new_anim</span>
        <span class="err">$</span><span class="n">AnimationPlayer</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">anim</span><span class="p">)</span>

<span class="n">func</span> <span class="n">_physics_process</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
    <span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">gravity</span> <span class="o">*</span> <span class="n">delta</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">JUMP</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_on_floor</span><span class="p">():</span>
            <span class="n">change_state</span><span class="p">(</span><span class="n">IDLE</span><span class="p">)</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">move_and_slide</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">position</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
        <span class="n">get_tree</span><span class="p">()</span><span class="o">.</span><span class="n">reload_current_scene</span><span class="p">()</span></code></pre></div>

<p><a href="/blog/img/k2d_platf_sample.gif"><img src="/blog/img/k2d_platf_sample.gif" width="300"></a></p>

<p>We&rsquo;re using a very rudimentary state machine to handle the transitions between the character&rsquo;s idle, running, and jumping states.</p>

<p>When using <code>move_and_slide()</code> the function returns a vector representing the
movement that remained after the slide collision occurred. Setting that value back
to the character&rsquo;s <code>velocity</code> allows us to smoothly move up and down slopes. Try
removing <code>velocity =</code> and see what happens if you don&rsquo;t do this.</p>

<p>Also note that we&rsquo;ve added <code>Vector2(0, -1)</code> as the floor normal. This is a vector
pointing straight upward. This means that if the character collides with an object
that has this normal, it will be considered a floor.</p>

<p>Using the floor normal allows us to make jumping work, using <code>is_on_floor()</code>. This
function will only return <code>true</code> after a <code>move_and_slide()</code> collision where the
colliding body&rsquo;s normal is within 45 degrees of the given floor vector (this can
be adjusted by setting <code>floor_max_angle</code>).</p>

<p>This also allows you to implement other features like wall jumps using <code>is_on_wall()</code>,
for example.</p>

<h2 id="conclusion">Conclusion</h2>

<p>This introduction only scratches the surface of what&rsquo;s possible with KinematicBody2D.
As with all Godot nodes, <a href="http://docs.godotengine.org/en/latest/classes/class_kinematicbody2d.html" target="_blank">
the API documentation</a> is your friend, so reference it frequently until you&rsquo;re
comfortable with the class methods.</p>

<p>Kinematic bodies are so useful, that I&rsquo;ll probably do a followup &ldquo;Know Your Nodes&rdquo; exploring
more uses. Please comment below if you have ideas or suggestions for other examples you&rsquo;d
like to see.</p>

<h3 id="a-href-blog-img-kyn3-0-kinematicbody2d-zip-download-the-sample-project-a"><a href="/blog/img/KYN3.0_KinematicBody2D.zip">Download the sample project</a></h3>

<h3 id="helpful-links">Helpful Links:</h3>

<ul>
<li><a href="https://godotengine.org/download">Download Godot 3.0</a></li>
<li><a href="https://www.patreon.com/kidscancode">Support Me on Patreon</a></li>
</ul>
			</div>


				<h2>Comments</h2>
				<div id="disqus_thread"></div>
<script type="text/javascript">
    
    
    
    

     
    var disqus_shortname = 'kidscancode'; 

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


		</div>
        
  </body>
</html>
